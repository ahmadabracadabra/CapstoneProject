<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
</head>
<body class="bg-gray-900 min-h-screen">
    <div class="antialiased bg-gray-50 dark:bg-gray-900">
        <nav class="bg-white border-b border-gray-200 px-4 py-2.5 dark:bg-gray-800 dark:border-gray-700 fixed left-0 right-0 top-0 z-50">
          <div class="flex flex-wrap justify-between items-center">
            <div class="flex justify-start items-center">
              <button
                data-drawer-target="drawer-navigation"
                data-drawer-toggle="drawer-navigation"
                aria-controls="drawer-navigation"
                class="p-2 mr-2 text-gray-600 rounded-lg cursor-pointer md:hidden hover:text-gray-900 hover:bg-gray-100 focus:bg-gray-100 dark:focus:bg-gray-700 focus:ring-2 focus:ring-gray-100 dark:focus:ring-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
              >
                <svg
                  aria-hidden="true"
                  class="w-6 h-6"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fill-rule="evenodd"
                    d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h6a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
                    clip-rule="evenodd"
                  ></path>
                </svg>
                <svg
                  aria-hidden="true"
                  class="hidden w-6 h-6"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fill-rule="evenodd"
                    d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                    clip-rule="evenodd"
                  ></path>
                </svg>
                <span class="sr-only">Toggle sidebar</span>
              </button>
              <a href="" class="flex items-center justify-between mr-4">
                <img
                  src="Images/graduating-student.png"
                  class="mr-3 h-8"
                  alt="Logo"
                />
                <span class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white">SADAS</span>
              </a>
              <form action="#" method="GET" class="hidden md:block md:pl-2">
                <label for="topbar-search" class="sr-only">Search</label>
                <div class="relative md:w-64 md:w-96">
                  <div
                    class="flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"
                  >
                    <svg
                      class="w-5 h-5 text-gray-500 dark:text-gray-400"
                      fill="currentColor"
                      viewBox="0 0 20 20"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                      ></path>
                    </svg>
                  </div>
                  <input
                    type="text"
                    name="email"
                    id="topbar-search"
                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                    placeholder="Search"
                  />
                </div>
              </form>
            </div>
            <div class="flex items-center lg:order-2">
              <button
                type="button"
                data-drawer-toggle="drawer-navigation"
                aria-controls="drawer-navigation"
                class="p-2 mr-1 text-gray-500 rounded-lg md:hidden hover:text-gray-900 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-700 focus:ring-4 focus:ring-gray-300 dark:focus:ring-gray-600"
              >
                <span class="sr-only">Toggle search</span>
                <svg aria-hidden="true" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                  <path clip-rule="evenodd" fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"></path>
                </svg>
              </button>
              <!-- Notifications -->
              <button
                type="button"
                data-dropdown-toggle="notification-dropdown"
                class="p-2 mr-1 text-gray-500 rounded-lg hover:text-gray-900 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-700 focus:ring-4 focus:ring-gray-300 dark:focus:ring-gray-600"
              >
                <span class="sr-only">View notifications</span>
                <!-- Bell icon -->
                <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M12 5.365V3m0 2.365a5.338 5.338 0 0 1 5.133 5.368v1.8c0 2.386 1.867 2.982 1.867 4.175 0 .593 0 1.292-.538 1.292H5.538C5 18 5 17.301 5 16.708c0-1.193 1.867-1.789 1.867-4.175v-1.8A5.338 5.338 0 0 1 12 5.365ZM8.733 18c.094.852.306 1.54.944 2.112a3.48 3.48 0 0 0 4.646 0c.638-.572 1.236-1.26 1.33-2.112h-6.92Z"/>
                </svg>
                
                  <path
                    d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"
                  ></path>
                </svg>
              </button>
              <!-- Dropdown menu -->
               <div
               class="hidden overflow-hidden z-50 my-4 max-w-sm text-base list-none bg-white rounded divide-y divide-gray-100 shadow-lg dark:divide-gray-600 dark:bg-gray-700 rounded-xl"
               id="notification-dropdown"
               >
               <div class="block py-2 px-4 text-base font-medium text-center text-gray-700 bg-gray-50 dark:bg-gray-600 dark:text-gray-300">
               Notifications
               </div>
               <div id="notification-list">
               <!-- Notifications here -->
               </div>
               </div>

              <!-- avatar --> 
              <button
                type="button"
                class="flex mx-3 text-sm bg-gray-800 rounded-full md:mr-0 focus:ring-4 focus:ring-gray-300 dark:focus:ring-gray-600"
                id="user-menu-button"
                aria-expanded="false"
                data-dropdown-toggle="dropdown"
              >
                <span class="sr-only">Open user menu</span>
                <img
                  class="w-8 h-8 rounded-full"
                  src="Images/spongebob-avatar.jpeg"
                  alt="user photo"
                />
              </button>
              <!-- Dropdown menu -->
               <div
               class="hidden z-50 my-4 w-56 text-base list-none bg-white rounded divide-y divide-gray-100 shadow dark:bg-gray-700 dark:divide-gray-600 rounded-xl"
               id="dropdown"
               >
               <div class="py-3 px-4">
                 <span
                   id="user-name"
                   class="block text-sm font-semibold text-gray-900 dark:text-white"
                   >Loading...</span
                 >
                 <span
                   id="user-email"
                   class="block text-sm text-gray-900 truncate dark:text-white"
                   >Loading...</span
                 >
               </div>
               <ul class="py-1 text-gray-700 dark:text-gray-300" aria-labelledby="dropdown">
                 <li>
                   <a
                     href="#"
                     class="block py-2 px-4 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-400 dark:hover:text-white"
                     >Profile</a
                   >
                 </li>
                 <li>
                   <a
                     href="#"
                     class="block py-2 px-4 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-400 dark:hover:text-white"
                     >Settings</a
                   >
                 </li>
               </ul>
              
               <ul class="py-1 text-gray-700 dark:text-gray-300" aria-labelledby="dropdown">
                 <li>
                   <a
                     href="#"
                     id="logoutButton"
                     class="block py-2 px-4 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"
                     >Sign Out</a
                   >
                 </li>
               </ul>
               </div>
            </div>
          </div>
        </nav>
        <div class="flex h-screen bg-gray-100 dark:bg-gray-900">
                   <!-- Sidebar -->
<aside
class="fixed top-0 left-0 z-40 w-64 h-screen pt-14 transition-transform bg-white border-r border-gray-200 dark:bg-gray-800 dark:border-gray-700"
aria-label="Sidenav"
id="drawer-navigation"
>
<div class="overflow-y-auto py-5 px-3 h-full bg-white dark:bg-gray-800">
  <form action="#" method="GET" class="md:hidden mb-2">
    <label for="sidebar-search" class="sr-only">Search</label>
    <div class="relative">
      <div class="flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none">
        <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"></path>
        </svg>
      </div>
      <input
        type="text"
        name="search"
        id="sidebar-search"
        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full pl-10 p-2 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
        placeholder="Search"
      />
    </div>
  </form>
  <ul class="space-y-2">
    <li>
      <a href="dashboard.html" class="flex items-center p-2 text-base font-medium text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group">
        <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m4 12 8-8 8 8M6 10.5V19a1 1 0 0 0 1 1h3v-3a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3h3a1 1 0 0 0 1-1v-8.5"/>
        </svg>
        <span class="ml-3">Overview</span>
      </a>
    </li>
    <li>
      <a href="calendar.html" class="flex items-center p-2 w-full text-base font-medium text-gray-900 rounded-lg transition duration-75 group hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700">
        <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 10h16m-8-3V4M7 7V4m10 3V4M5 20h14a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1H5a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1Zm3-7h.01v.01H8V13Zm4 0h.01v.01H12V13Zm4 0h.01v.01H16V13Zm-8 4h.01v.01H8V17Zm4 0h.01v.01H12V17Zm4 0h.01v.01H16V17Z"/>
        </svg>
        <span class="flex-1 ml-3 text-left whitespace-nowrap">Calendar</span>
      </a>
    </li>
    <li>
      <a href="#.html" class="flex items-center p-2 w-full text-base font-medium text-gray-900 rounded-lg transition duration-75 group hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700">
        <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 6H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1Zm7 11-6-2V9l6-2v10Z"/>
        </svg>
        <span class="flex-1 ml-3 text-left whitespace-nowrap">Video Chat</span>
      </a>
    </li>
    <li>
      <a href="messaging.html" class="flex items-center p-2 text-base font-medium text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group">
        <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17h6l3 3v-3h2V9h-2M4 4h11v8H9l-3 3v-3H4V4Z"/>
        </svg>
        <span class="flex-1 ml-3 whitespace-nowrap">Messages</span>
        <span class="inline-flex justify-center items-center w-5 h-5 text-xs font-semibold rounded-full text-primary-800 bg-primary-100 dark:bg-primary-200 dark:text-primary-800">
          4
        </span>
      </a>
    </li>
  </ul>
  <ul class="pt-5 mt-5 space-y-2 border-t border-gray-200 dark:border-gray-700">

    <li>
      <a href="#" class="flex items-center p-2 text-base font-medium text-gray-900 rounded-lg transition duration-75 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-white group">
        <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
          <path stroke="currentColor" stroke-linecap="square" stroke-linejoin="round" stroke-width="2" d="M10 19H5a1 1 0 0 1-1-1v-1a3 3 0 0 1 3-3h2m10 1a3 3 0 0 1-3 3m3-3a3 3 0 0 0-3-3m3 3h1m-4 3a3 3 0 0 1-3-3m3 3v1m-3-4a3 3 0 0 1 3-3m-3 3h-1m4-3v-1m-2.121 1.879-.707-.707m5.656 5.656-.707-.707m-4.242 0-.707.707m5.656-5.656-.707.707M12 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
        </svg>
        <span class="ml-3">Settings</span>
      </a>
    </li>
    
    <li>
      <a href="#" class="flex items-center p-2 text-base font-medium text-gray-900 rounded-lg transition duration-75 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-white group">
        <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 14v7M5 4.971v9.541c5.6-5.538 8.4 2.64 14-.086v-9.54C13.4 7.61 10.6-.568 5 4.97Z"/>
        </svg>
        <span class="ml-3">Help</span>
      </a>
    </li>
  </ul>
  </div>
</aside>
<!-- End Sidebar -->
          
<!-- Messaging Section -->
<div class="flex-1 flex flex-col ml-64">
  <!-- Header -->
  <header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-4">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Messages</h2>
  </header>

  <!-- Chat List and Chat Area -->
  <div class="flex-1 flex overflow-hidden">
    <!-- Chat List -->
    <aside class="w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 p-4">
      <!-- Search and Add Friend -->
      <div class="mb-4">
        <input
          type="text"
          id="search-friends"
          placeholder="Search for friends"
          class="w-full p-2 mb-2 border rounded-lg bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
        />
        <button
          id="add-friend-btn"
          class="w-full p-2 bg-green-500 text-white rounded-lg hover:bg-green-600"
        >
          Add Friend
        </button>
      </div>
    
      <!-- Search Results -->
      <ul id="search-results" class="space-y-2 mb-4">
        <!-- Dynamically populated search results will be inserted here -->
      </ul>
    
      <!-- Friend Requests Section -->
      <div class="friend-requests-container mt-6">
        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Friend Requests</h3>
        <ul id="friend-requests-list" class="space-y-2 overflow-y-auto max-h-[200px]">
          <!-- If no friend requests, show a message -->
          <li class="text-gray-500 dark:text-gray-400 text-sm">No friend requests at the moment.</li>
        </ul>
      </div>
    
      <!-- Friend List -->
      <ul id="friend-list" class="space-y-2 overflow-y-auto max-h-[calc(100vh-300px)]">
        <!-- Dynamic Friends will be listed here -->
      </ul>
    </aside>
    

    <!-- Chat Area -->
    <div class="flex-1 flex flex-col bg-white dark:bg-gray-800">
      <!-- Chat Header -->
      <div class="border-b border-gray-200 dark:border-gray-700 p-4">
        <div id="chat-header" class="flex items-center hidden">
          <img
            id="chat-avatar"
            src="https://via.placeholder.com/40"
            alt="Friend Avatar"
            class="w-8 h-8 rounded-full mr-3"
          />
          <div>
            <p id="chat-friend-name" class="text-lg font-semibold text-gray-900 dark:text-white"></p>
            <p id="chat-status" class="text-xs text-gray-500 dark:text-gray-400">Online</p>
          </div>
        </div>
      </div>

      <!-- Chat Messages -->
      <div id="messages" class="flex-1 overflow-y-auto p-4 space-y-4">
        <!-- Dynamic Chat Messages will appear here -->
      </div>

      <!-- Message Input -->
      <div class="border-t border-gray-200 dark:border-gray-700 p-4">
        <div class="flex items-center">
          <input
            id="message-input"
            type="text"
            placeholder="Type a message..."
            class="flex-1 p-2 border rounded-lg bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
          />
          <button id="send-message" class="ml-2 p-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"
              ></path>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  async function getUserData() {
    const token = localStorage.getItem('token');
    if (!token) {
      window.location.href = '/login';  
      return;
    }

    try {
      const response = await fetch('http://localhost:8080/dashboard', {
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json',
        }
      });

      if (!response.ok) throw new Error('Failed to fetch user data');
      
      const user = await response.json();
      
      document.getElementById("user-name").textContent = user.username || "Unknown User";
      document.getElementById("user-email").textContent = user.email || "user@example.com";

    } catch (error) {
      console.error('Error fetching user data:', error);
    }
  }

  document.getElementById("logoutButton").addEventListener("click", async function (event) {
    event.preventDefault(); 

    try {
      const token = localStorage.getItem("token");

      const response = await fetch("http://localhost:8080/logout", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`, 
        },
      });

      if (response.ok) {
        localStorage.removeItem("token");
        sessionStorage.removeItem("token");

        window.location.href = "login.html"; 
      } else {
        console.error("Logout failed:", await response.json());
      }
    } catch (error) {
      console.error("Error during logout:", error);
    }
  });


  //FRIENDS
async function fetchFriendRequests() {
  const token = localStorage.getItem('token');
  if (!token) {
    window.location.href = '/login';  
    return;
  }

  try {
    const response = await fetch('http://localhost:8080/friend-requests', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json',
      }
    });

    if (!response.ok) throw new Error('Failed to fetch friend requests');

    const requests = await response.json();
    const friendRequestsList = document.getElementById('friend-requests-list');
    friendRequestsList.innerHTML = ''; 

    if (requests.length === 0) {
      friendRequestsList.innerHTML = '<li class="text-gray-500 dark:text-gray-400 text-sm">No friend requests at the moment.</li>';
    } else {
      requests.forEach(request => {
        const listItem = document.createElement('li');
        listItem.classList.add('p-2', 'bg-gray-200', 'rounded', 'flex', 'justify-between', 'items-center');
        
        listItem.innerHTML = `
          <span class="font-semibold">${request.senderUsername}</span>
          <button class="accept-btn" data-id="${request.requestID}">Accept</button>
          <button class="decline-btn" data-id="${request.requestID}">Decline</button>
        `;

        friendRequestsList.appendChild(listItem);

        listItem.querySelector('.accept-btn').addEventListener('click', async () => {
          await handleAcceptRequest(request.requestID, request.creatorID);
        });

        listItem.querySelector('.decline-btn').addEventListener('click', async () => {
          await handleDeclineRequest(request.requestID, request.creatorID);
        });
      });
    }
  } catch (error) {
    console.error('Error displaying friend requests:', error);
  }
}

async function handleAcceptRequest(requestId, creatorID) {
  const token = localStorage.getItem('token');
  if (!token) {
    window.location.href = '/login';  
    return;
  }

  try {
    const response = await fetch('http://localhost:8080/friend-request/accept', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ creatorID })
    });

    const result = await response.json();

    if (response.ok) {
      alert('Friend request accepted');
      await displayFriendRequests();
      await displayFriendsList();
 
    } else {
      console.error(result.message || 'Error accepting friend request');
    }
  } catch (error) {
    console.error('Error handling accept request:', error);
  }
}

async function handleDeclineRequest(requestId, creatorID) {
  const token = localStorage.getItem('token');
  if (!token) {
    window.location.href = '/login';  
    return;
  }

  try {
    const response = await fetch('http://localhost:8080/friend-request/decline', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ creatorID })
    });

    const result = await response.json();

    if (response.ok) {
      alert('Friend request declined');
      await displayFriendRequests();
      await displayFriendsList();
   
    } else {
      console.error(result.message || 'Error declining friend request');
    }
  } catch (error) {
    console.error('Error handling decline request:', error);
  }
}


async function fetchFriendsList() {
  const token = localStorage.getItem('token');
  if (!token) {
    window.location.href = '/login';  
    return;
  }

  try {
    console.log("Fetching friends list...");
    const response = await fetch('http://localhost:8080/friends-list', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json',
      }
    });

    if (!response.ok) throw new Error('Failed to fetch friends list');
    
    const friends = await response.json();

    const friendList = document.getElementById('friend-list');
    if (!friendList) {
      console.error("Friend list element not found");
      return;
    }
    
    friendList.innerHTML = ''; 
    
    if (friends.length === 0) {
      friendList.innerHTML = '<li class="text-gray-500 dark:text-gray-400 text-sm">You have no friends yet.</li>';
    } else {
      friends.forEach(friend => {
        const listItem = document.createElement('li');
        listItem.classList.add('p-2', 'bg-gray-200', 'rounded');
        listItem.textContent = friend.username; 
        friendList.appendChild(listItem);
      });
    }
  } catch (error) {
    console.error('Error fetching friends list:', error);
  }
}


async function searchForFriends() {
  const searchTerm = document.getElementById('search-friends').value.trim();
  const token = localStorage.getItem('token');

  if (!token) {
    window.location.href = '/login';  
    return;
  }

  try {
    if (searchTerm.length > 0) {
      const response = await fetch(`http://localhost:8080/friends-search?q=${encodeURIComponent(searchTerm)}`, {
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json',
        }
      });

      if (!response.ok) throw new Error('Failed to search for friends');

      const users = await response.json();
      displaySearchResults(users);
    } else {
      document.getElementById('search-results').innerHTML = '';
    }
  } catch (error) {
    console.error('Error searching for friends:', error);
  }
}

function displaySearchResults(users) {
  const resultsContainer = document.getElementById('search-results');
  resultsContainer.innerHTML = ''; 

  if (users.length === 0) {
    resultsContainer.innerHTML = '<li class="text-gray-500 dark:text-gray-400 text-sm">No users found.</li>';
  } else {
    users.forEach(user => {
      const listItem = document.createElement('li');
      listItem.classList.add('p-2', 'bg-gray-200', 'rounded', 'flex', 'justify-between', 'items-center');
      listItem.innerHTML = `
        <span class="font-semibold dark:text-white">${user.username}</span>
        <button class="add-btn p-1 bg-green-500 text-white rounded-lg hover:bg-green-600" data-id="${user.UserID}">
          Add Friend
        </button>
      `;

      resultsContainer.appendChild(listItem);

      listItem.querySelector('.add-btn').addEventListener('click', async function() {
        console.log("Attempting to send friend request to UserID:", user.UserID);
        if (!user.UserID) {
          console.error("Error: UserID is undefined or null.");
          return;
        }
        await sendFriendRequest(user.UserID);
      });
    });
  }
}

async function sendFriendRequest(userId) {
  if (!userId) {
    console.error("sendFriendRequest error: userId is missing or null.");
    return;
  }

  const token = localStorage.getItem('token');

  if (!token) {
    window.location.href = '/login';
    return;
  }

  console.log("Sending request with receiverID:", userId); // Debugging

  try {
    const response = await fetch(`http://localhost:8080/friend-request/send`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ receiverID: userId }) 
    });

    if (!response.ok) throw new Error('Failed to send friend request');

    alert('Friend request sent successfully!');
  } catch (error) {
    console.error('Error sending friend request:', error);
  }
}

document.getElementById('search-friends').addEventListener('input', searchForFriends);


window.onload = function() {
  fetchFriendRequests();
  fetchFriendsList();
  getUserData();
};

</script>


  <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>
</body>
</html>